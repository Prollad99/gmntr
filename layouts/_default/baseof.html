<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }}</title>
    <link rel="manifest" href="/manifest.json">
    <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
      .then(function(registration) {
        console.log('Service Worker registered with scope:', registration.scope);
      }).catch(function(error) {
        console.log('Service Worker registration failed:', error);
      });
    }

    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;

      const installButton = document.createElement('button');
      installButton.innerText = 'Install';
      document.body.appendChild(installButton);

      installButton.addEventListener('click', () => {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted the install prompt');
            // Optionally, save the user's choice to localStorage
            localStorage.setItem('pwaInstalled', 'yes');
          } else {
            console.log('User dismissed the install prompt');
          }
          deferredPrompt = null;
          installButton.remove();
        });
      });
    });

    // Check if the app was previously installed
    if (localStorage.getItem('pwaInstalled') === 'yes') {
      // Optionally, clear the flag to allow showing the prompt again in the future
      localStorage.removeItem('pwaInstalled');
    }
  </script>
    <!-- Preload CSS to improve render time -->
    <link rel="preload" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" as="style">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">

    <link rel="preload" href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css' as="style">
    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css' rel='stylesheet' />

    <link rel="canonical" href="{{ .Permalink }}">
    <link href="{{ "css/main.css" | relURL }}" rel="stylesheet">
    <link rel="icon" href="{{ "favicon.ico" | relURL }}">

    <!-- Meta Description -->
    <meta name="description" content="{{ if .Params.metaDescription }}{{ .Params.metaDescription }}{{ else }}{{ .Summary | plainify | htmlEscape }}{{ end }}">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{{ .Title }}">
    <meta property="og:description" content="{{ if .Params.metaDescription }}{{ .Params.metaDescription }}{{ else }}{{ .Summary | plainify | htmlEscape }}{{ end }}">
    <meta property="og:image" content="{{ if .Params.image }}{{ .Site.BaseURL }}{{ .Params.image }}{{ else }}{{ .Site.BaseURL }}/images/default-og-image.jpg{{ end }}">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:type" content="article">

    <!-- Twitter Cards Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ .Title }}">
    <meta name="twitter:description" content="{{ if .Params.metaDescription }}{{ .Params.metaDescription }}{{ else }}{{ .Summary | plainify | htmlEscape }}{{ end }}">
    <meta name="twitter:image" content="{{ if .Params.image }}{{ .Site.BaseURL }}{{ .Params.image }}{{ else }}{{ .Site.BaseURL }}/images/default-twitter-image.jpg{{ end }}">
</head>

<body>
    <!-- Header Partial -->
    {{ partial "header.html" . }}
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-white shadow-sm">
            <li class="breadcrumb-item"><a href="/" class="text-decoration-none"><i class="bi bi-house-fill"></i> Home</a></li>
            {{ if .IsPage }}
            <li class="breadcrumb-item active" aria-current="page">{{ .Title }}</li>
            {{ end }}
        </ol>
    </nav>
    <!-- Main Content -->
    {{ block "main" . }}{{ end }}

    <!-- Footer Partial -->
    {{ partial "footer.html" . }}

    <!-- Install banner HTML -->
    <div id="installBanner" style="display:none;">
        <button id="installButton">Install GameTwist Free Coins</button>
    </div>

    <!-- Defer loading of JS to improve performance -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
</body>

</html>